---
title: "Models: GAM Hierarchical"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Models: GAM Hierarchical}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


## Data prep

### Load packages


```r
library(bbsBayes2)
library(patchwork)
library(ggplot2)
```

### Stratify
Here we use a range-restricted species

```r
s <- stratify(by = "bbs_cws", species="Hepatic Tanager")
```

### Prepare counts
Here we create a model for 10 years, to decrease run time. The default is to use the full range of data available.

```r
p <- prepare_data(s, min_year=2009, max_year=2019)
```

### Prepare model


```r
md <- prepare_model(p, model = "gam", model_variant = "hier")
```

## Run model
A model with the minimum number of iterations and chains for speedy processing, at the expense of accuracy. We recommend using the defaults, 4 chains, 1000 iterations for both warmup and sampling, and assessing convergence.

```r
m <- run_model(md, iter_sampling = 100, iter_warmup = 500, chains = 2)
```

## Explore results

### Convergence



```r
conv <- get_convergence(m)
conv
```

### Indices


```r
i <- generate_indices(model_output = m,
                      regions = c("continent",
                                  "country",
                                  "prov_state",
                                  "stratum"))

p <- plot_indices(i, add_observed_means = TRUE)
```



```r
patchwork::wrap_plots(p, ncol = 3)
```

![plot of chunk unnamed-chunk-8](figure/unnamed-chunk-8-1.png)

<img src="figures/gam_index-1.png" />

### Trends


```r
t <- generate_trends(indices = i)
plot_map(trends = t)
```

![plot of chunk unnamed-chunk-9](figure/unnamed-chunk-9-1.png)

<img src="figures/gam_trend-1.png"/>


### Geofacet plots


```r
plot_geofacet(indices = i, trends = t)
```

![plot of chunk unnamed-chunk-10](figure/unnamed-chunk-10-1.png)

<img src="figures/gam_geo-1.png"  />

## Reproducibility and Clean up


```r
list.files(pattern = "csv|rds")
unlink(list.files(pattern = "csv|rds"))
```



```r
devtools::session_info()
```

```
## Error in loadNamespace(x): there is no package called 'devtools'
```
